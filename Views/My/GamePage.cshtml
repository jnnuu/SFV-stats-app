@using System;


@{
    Layout = "_Layout";
}
@section head
{
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script> 
    <link rel="stylesheet" href="~/css/gamepage.css"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="/img/touch_icon.png">
    <link media="only screen and (max-device-width: 480px)" href="small-device.css" type= "text/css" rel="stylesheet">
}
@functions{
    //set up correct id's for the playerBox divs.
    public string getFighterId(string dataKey)
    {
        string name = ViewData[dataKey] as string;
        int i = 0;
        foreach (var en in Enum.GetNames(typeof(Fighter_id)))
        {
            string HeroName = "";
            for (int j = 0; j < en.Length; j++)
            {
                HeroName += en[j];
            }
            if (name == HeroName)
            {
                break;
            }
            i++;
        }
        return i.ToString(); //return enum as string (1,2,3,4...)
    }
     public string GetWinPercentageP2()
     {
        int played = (int)ViewData["id2_played"];
        int won = (int)ViewData["id2_won"];
        System.Console.WriteLine($"p2:w:{won}/p:{played}");
        if (won == 0 || played == 0)
            return 0.ToString("P0");

        float percentage = (float)won/played;
        string returnString = percentage.ToString("P0");
        return returnString;
     }
     public string GetWinPercentageP1()
     {
        int played = (int)ViewData["id1_played"];
        int won = (int)ViewData["id1_won"];
        System.Console.WriteLine($"p1:w:{won}/p:{played}");
        if (won == 0 || played == 0)
            return 0.ToString("P0");

        float percentage = (float)won/played;
        string returnString = percentage.ToString("P0");
        return returnString;
     }
    public string TopThreePlayed()
    {
        Fighter[] fighters = ViewData["TopThreePlayed"] as Fighter[];
        string retstring = "";
        for (int i = 0 ; i<fighters.Length; i++)
        {
            retstring += $"{i+1}. {fighters[i].name} ({fighters[i].timesPlayed}) \n";
        }
        return retstring;
    }
    public string TopThreeWins()
    {
        Fighter[] fighters = ViewData["TopThreeWins"] as Fighter[];
        string retstring = "";
        for (int i = 0; i<fighters.Length;i++)
        {
            //calculate win percentage first
            float winPerc = fighters[i].timesWon / fighters[i].timesPlayed;
            retstring += $"{i+1}. {fighters[i].name} ({winPerc.ToString("P0")}) \n";
            
        }
        return retstring;
    }


}
<div class="container">
    <div id="@getFighterId("PlayerOne")" class="playerBox1">
        <div class="stats p1">WIN percentage: @GetWinPercentageP1()</div>
        <a href="/sfv">
        <button onclick="InputWinner(@getFighterId("PlayerOne"), @getFighterId("PlayerTwo"))">
        <img src="@ViewData["PlayerOneAvatar"]">
        </button>
        </a> 
    </div>
    <div id="@getFighterId("PlayerTwo")" class="playerBox2">
        <a href="/sfv">
        <button onclick="InputWinner(@getFighterId("PlayerTwo"), @getFighterId("PlayerOne"))">
            <img src="@ViewData["PlayerTwoAvatar"]">
        </button>
        </a> 
        <div class="stats p2">WIN percentage: @GetWinPercentageP2()</div>
    </div>
</div>
<div class="GeneralStats">
    <div class="top3winrate">@TopThreePlayed()</div>
    <div class="top3played">@TopThreeWins()</div>
</div>
<script>
    function InputWinner(id1, id2) //winner, loser id
    {
        var winUrl = "http://192.168.100.19:5000/sfv/winner/";
        var loseUrl = "http://192.168.100.19:5000/sfv/loser/";
        winUrl += id1;
        loseUrl += id2;
        console.log("Winner url: " + winUrl);
        console.log("Loser url: " + loseUrl);
        @{System.Console.WriteLine("posted!");}
        $.ajax(winUrl, {
            type: 'POST',
        })
        $.ajax(loseUrl, {
            type: 'POST',
        })
    }
</script>

